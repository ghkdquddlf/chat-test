// RAG 코드드
// import { OpenAIStream, StreamingTextResponse } from 'ai';
// import OpenAI from 'openai';

// const openai = new OpenAI({
//   apiKey: process.env.OPENAI_API_KEY
// });

// const DOCUMENT_TEXT = `
// 우리나라 감자 재배면적은 약 20,540ha이며, 이 중 약 80%는 봄 감자로 재배되고 있다(농
// 림수산식품부, 2009). 2020년 감자 생산량은 1993년에 비해 약 30%가 증가될 것으로 전망
// 하고 있다(Gregory 등, 2000).
// 멀칭은 지온의 조절, 토양수분의 보존, 잡초발생의 억제, 토양물리성의 향상 등의 효과가
// 있다(Jensen, 1988). 플라스틱 필름 멀칭은 지온상승과 수분 손실 억제에 매우 효과적이며
// 가격이 저렴할 뿐만 아니라 내구성이 크고 사용이 편리한 이유 등으로 인하여 작물 재배에
// 가장 보편적으로 사용되고 있으나(Jensen, 1988; Unger, 1978), 환경부하를 증가시키는 요인
// 으로 작용하고 있다.
// 최근 들어 친환경재배 연구가 활발하게 이루어지고 있는데, 일본 잎갈나무 멀칭은 잔대
// 수량이 증가하고 잡초 발생량과 잡초 발생수가 적었다(김, 2004). 짚 멀칭은 잡초 발생량을
// 현저하게 감소 시켰으며(변, 1985), 토마토 재배시 토양 가비중을 감소시켜 플라스틱 멀칭
// 보다 토양의 물리 ․ 화학적 개선 효과가 우수하다고 보고하였다(Tindall 등, 1991). 가지, 상
// 추, 양파 재배시 낙엽 멀칭은 잡초방제 효과와 함수량이 높았으며, 전반적인 생육과 수량은
// 솔잎 멀칭구에서 가장 높았다고 하였다(김, 2002; 김, 2003; 김, 2008).
// 토양 수분 함량은 작물의 생육 및 품질과 밀접한 관련이 있으며(황과 태, 2001; 유와 배,
// 2004), 토양 수분 함량은 작물의 팽압 유지나 작물이 필요로 하는 양분의 운반, 식물체온의
// 하강 등의 역할을 한다. 토양수분은 토양의 종류나 물리 ․ 화학적 상태, 작물의 종류, 멀칭재
// 료 및 방법, 광, 온도, 공중습도 등과 직 ․ 간접적인 영향을 받는다. 토양수분 함량이 식물체
// 의 무기성분 함량에도 영향을 미치며(유와 배, 2004), 생강의 지하부인 덩이줄기 수량에도
// 영향을 미친다(전 등, 1997). 감자 봄재배시 출아기의 저온과 괴경 비대기의 고온뿐만 아니
// 라 가을 재배시 출아기의 고온을 해결하는 대안으로 제시 하였다(최, 1999).
// 잡초는 지역에 따라 작물 재배시기에 따라 우점하는 잡초가 다르며(임 등, 2002; 황 등,
// 2003), 농경지에서 시간적, 공간적 제약성 때문에 짧은 생활사를 가진 초종들이 군락을 이
// 루고 있다(구 등, 1999). 잡초를 제거하기 위해 예방적, 경종적방제, 제초제 등을 사용하는
// 종합적 방제하는 것이 효과적이며(김 등, 1988), 밭 잡초 방제용으로 자연 분해 비닐이 개발
// 되었으나(강 등, 2009), 노지 밭작물의 친환경 재배가 확산되면서 고랑의 잡초를 인력으로
// 해결해야 하는 어려움이 있다.
// 본 시험은 소비자들의 친환경 유기농산물을 선호하는 소비 추세에 맞춰 주위에서 쉽게
// 구할 수 있는 농림부산물을 사용하여 멀칭에 따른 감자 생육, 수량 및 잡초의 발생에 미치
// 는 영향을 구명코자 실시하였다
// 본 시험은 충북대학교 부속농장 시험포장에서 가을 감자재배와 봄 감자재배로 구분하여
// 시험하였다. 가을재배는 2008년 8월 9일 파종하여 10월 25일에 수확하였으며, 봄 재배는
// 2009년 4월 4일 파종하여 6월 28일에 수확하였다.
// 멀칭 재료에 따라 솔잎(pine tree leaf) 멀칭구, 참나무잎(oak tree leaf) 멀칭구, 볏짚(rice
// straw) 멀칭구, 왕겨(rice hull) 멀칭구, 톱밥(sawdust) 멀칭구, 대조구(control) 등 5처리를 난괴
// 법 3반복으로 배치하였다. 반복당 30주를 재식하였으며, 대조구를 제외한 멀칭 처리구는
// 각각의 유기물을 5cm 두께로 멀칭 하였다. 왕겨와 톱밥은 1년 이상 비를 맞히어 충분히 수
// 분 보유력을 높인 것을 사용하였으며, 멀칭 처리는 파종 직후에 실시하였다.
// 씨감자는 괴산군 농업기술센터에서 조직배양과 수경재배에 의해 생산된 ‘수미’ 품종을
// 파종 전 25일간 산광 최아 후 맹아가 1.3±0.2 cm 자란 것을 사용하였다. 가을감자는 60×20
// cm 간격으로, 봄감자는 70×25cm 간격으로 파종하였다. 씨감자 파종 깊이는 가을감자 5cm,
// 봄감자 8cm 깊이로 하였다. 토양검정 시비하였으며, 기타 재배법은 감자 표준 영농교본(농
// 촌진흥청, 2003)을 따랐다.
// 감자의 생육 및 수량 특성은 시험 연구 분석 조사 기준을 따랐다(농촌진흥청, 1995). 지
// 온은 디지털 온도계(TR-71, 일본)로 파종 후부터 수확 시까지 지표면으로부터 10cm 깊이에
// 서 측정하였다. 토양수분 함량 측정은 건토중량법으로 생육시기에 따라 4회 조사하였다.
// 즉, 지표면으로부터 10cm 깊이의 토양시료를 채취하여 토양의 무게를 측정 후 건조기
// (WOF-155, 한국)를 이용하여 105℃에서 24시간 건조시키고 토양 무게를 측정하여 토양 수
// 분 함량을 조사하였다.
// 잡초 발생량 조사는 가을 재배시 2008년 9월 6일과 10월 4일에, 봄재배시 2009년 5월 5
// 일, 5월 24일에 각각 2회 조사하였으며, 노 등(2004)의 방법으로 잡초 발생이 균일한 지점의
// 50×50cm의 격자를 이용하여 잡초를 채취한 다음 깨끗이 씻고 초종별 분류 및 개체수 조사
// 와 생체중과 건물중을 측정하였다. 건물중은 열풍건조기(WOF-155, 한국)를 이용하여 80℃
// 에서 48시간 건조 후 측정하였다.
// Ⅲ.결과 및 고찰
// 1.지온
// 가을 재배시 대조구의 지온은 멀칭 처리구보다 평균 생육 단계에 따라 2.3~2.8℃ 높았으
// 며, 멀칭 재료에 따라 지온은 17.9~22.7℃의 분포를 나타냈다(Fig. 1). 감자 재배시 투명 PE 필름과 흑색 PE 필름 멀칭은 무멀칭구보다 일평균 지온이 상승하였으나, 종이 멀칭 처리구
// 에서는 무멀칭구보다 감소하였다고 보고하였다(최, 1999).
// 봄감자 멀칭 재료에 따른 지온은 멀칭 처리구가 대조구보다 0.7~2.3℃ 낮았으며, 멀칭으
// 로 인한 지온 하강 효과는 솔잎 멀칭구>짚 멀칭구>참나무잎 멀칭구>왕겨 멀칭구>톱밥 멀
// 칭구 순이었다. 토양 멀칭은 봄 감자 재배시 출아기의 저온과 괴경 비대기의 고온을, 가을
// 감자 재배시 괴경 비대기의 고온으로 인한 피해를 경감할 수 있는 멀칭재배를 대안으로 제
// 시하였다(최, 1999). 본 연구에서도 선행 연구(최, 1999)와 같이 멀칭 재료에 따라 일평균 지
// 온이 가을 재배시 2.3~2.8℃, 봄재배시 0.7~2.3℃ 온도 하강 효과가 있었다.

// 2.토양수분 함량
// 가을 재배시 토양수분 함량은 모든 멀칭 처리구에서 대조구 12.3% 보다 2.6~5.1% 증가한
// 14.9~17.4%의 분포를 나타냈다(Table 1). 일반적으로 수분 보유력이 적은 왕겨와 톱밥 멀칭
// 구의 토양 수분 함량이 각각 17.4%와 16.2%로 높게 나타난 것은 본 시험에 사용된 왕겨와
// 톱밥은 장기간 강우에 노출되어 수분 함유가 용이하였기 때문으로 생각된다.
// 멀칭에 따른 토양 수분 함량의 변동 폭은 대조구 6.7%에 비해 멀칭 처리구에서는 4.5~
// 4.9%로 낮았다. 토양 수분 함량의 변이계수는 대조구와 왕겨 멀칭구에서 높았다. 토양 수분
// 은 토양의 물리 ․ 화학적 특성, 유기물 함량, 토양관리 등에 따라 다르다. 토양 경작층에서의
// 수분함량은 경운이나 강우에 의해 수분 함량의 영향을 받으며, 심토에서는 토성에 의해 영
// 향을 받는다(Kim et al., 2002).
// 봄 재배시 토양수분 함량은 가을재배와 같이 왕겨와 톱밥 멀칭구에서 각각 16.7%와 15.7%로 가장 높았는데, 미세한 입자의 왕겨와 톱밥이 토양 수분 증발을 억제하여 토양 수
// 분을 유지한 것으로 생각된다. 멀칭 처리구의 토양수분 함량은 멀칭하지 않은 대조구보다
// 높았다. 토양 수분 변동 폭은 무 멀칭구인 대조구에서 5.5%로 가장 컸으며, 볏짚 멀칭구에
// 서 4.3%로 가장 적었다. 토양 수분 변이계수는 참나무잎 멀칭구를 제외한 모든 처리구에서
// 비슷하였다.
// 3.생육 특성
// 가을 재배시 멀칭재료에 의한 초장은 처리에 따라 51.4~55.8cm로 처리간에 통계적인 유
// 의성을 나타내지 않았다(Table 2). 엽장은 6.1~6.4cm로 처리간에 차이가 없었으나, 엽폭은
// 솔잎 멀칭구와는 다른 멀칭구와 유의성이 인정되었다. 봄 재배시 초장은 대조구와 톱밥 멀
// 칭구는 다른 멀칭구와 유의성을 나타냈다. 엽장은 솔잎 멀칭구와 볏짚 멀칭구에서 가장 길
// 었으며, 대조구에서 가장 짧아 멀칭구와 유의성을 나타냈다. 엽폭은 가을재배와 같은 경향
// 으로 솔잎 멀칭구와 볏짚 멀칭구에서 가장 넓어 감자의 생육이 왕성함을 알 수 있었다.
// 4.수량 특성
// 가을 재배 감자의 주당 수량은 솔잎 멀칭구는 613g, 볏짚 멀칭구는 598g, 참나무 멀칭구
// 는 566g으로 대조구 419g과 통계적인 유의성을 나타냈다(Table 3). 멀칭 처리구가 대조구인
// 무멀칭구에 비해 지온이 낮고 토양 수분 함량 유지 등 괴경 형성과 비대에 알맞은 환경을
// 조성한 것으로 판단된다. 가을감자 재배시 짚 멀칭구가 무멀칭구에 비해 수량이 증대되었
// 다는 최와 조(1978)의 연구 결과와 일치하였다. 주당 괴경수는 솔잎 멀칭구 6.3개, 볏짚 멀
// 칭구 6.0개, 참나무 멀칭구 5.7개, 왕겨 멀칭구 5.2개, 톱밥 멀칭구 5.0개, 대조구 4.0개 순으
// 로 많았다.

// 봄 감자의 주당 수량은 가을감자 재배와 같은 경향으로 솔잎 멀칭구가 1,286g으로 가장
// 많았으며, 볏짚 멀칭구, 참나무잎 멀칭구, 왕겨 멀칭구, 톱밥 멀칭구, 대조구 순으로 많았다.
// 특히, 솔잎 멀칭구에서 계절에 관계없이 수량이 50~100% 증수한 원인에 대해 추가적인 연
// 구가 필요하다. 전 등(1997)은 토양 수분 함량이 생강의 덩이줄기 비대와 밀접한 관계가 있
// 으며, 조 등(1985)은 전 생육기간 동안 지하부 발육을 위해 적습 상태로 유지하는 것이 필
// 요하다고 보고하였다. 토양내 수분 함량을 높게 유지하면 토마토의 총 수량은 증가하지만
// (최 등, 1999), 토양내 산소 부족으로 뿌리의 부패율이 증가한다(전 등, 1997).
// 최(1999)는 봄 감자재배시 수량은 멀칭 재료에 영향을 받으며, 흑색 PE 필름 멀칭구와 종
// 이 멀칭구가 무멀칭구보다 각각 24%와 26% 증수하였다고 보고하였다. 토양수분 함량이 지
// 하부 수량에 영향을 미치며(전 등, 1997), 본 연구에서 모든 멀칭 처리구의 수량이 대조구보
// 다 증가하여 최와 조(1978)와 최(1999) 등의 연구 결과와 일치하였다. 멀칭 처리에 의한 토
// 양수분이 수량과 밀접한 관계가 있음을 시사하고 있다. 주당 괴경수는 솔잎 멀칭구가 8.4개
// 로 가장 많아 다른 처리구와 차이를 나타냈다.
// 5.발생 잡초의 종류 및 양
// 잡초는 농경지에서 1년 이내의 짧은 기간 동안 정기적인 예정된 교란 작업이 이루어짐으
// 로써 시간적, 공간적 제약성 때문에 짧은 생활사를 가진 초종들이 군락을 형성하는데(구
// 등, 1999), 가을 감자 재배시 멀칭에 따른 잡초 발생수는 멀칭 처리구가 대조구의 14~50%
// 수준이었으며, 톱밥 멀칭구는 잡초 발생을 억제 효과는 다른 멀칭 처리구보다 상대적으로
// 적었다(Table 4). 우점 잡초는 돌피와 명아주이며 망초와 뚝새풀이 뒤를 이었다.
// 봄 감자 재배시 잡초 발생수는 표면적이 비교적 넓은 참나무 멀칭구에서 적게 발생하였
// 으며, 톱밥 멀칭구는 잡초발생이 억제되었지만 다른 멀칭 처리구에 비해 효과가 적었다.
// 노와 변(2004)은 충청남 ․ 북도 하작물 재배지에 발생한 초종은 총 29과 82초종으로 보고하
// 였다.
// 본 연구에서 우점 잡초는 돌피였고, 방동사니, 명아주, 쇠비름, 바랭이 순으로 초종의 수
// 는 노와 변(2004)의 보고와 비교할 때 적었다. 이는 전작물의 종류, 토양 표면 관리 방법,
// 멀칭 등에 의한 차이 때문인 것으로 판단되었다. 하작물 재배지의 초종은 1990년대 초에는
// 바랭이, 쇠비름, 깨풀, 강아지풀, 방동사니, 명아주, 망초 등이 우점하였으나(연 등, 1991),
// 2000년대 초에는 바랭이, 쇠비름, 방동사니, 깨풀, 명아주, 피 등으로 우점종이 변함을 알
// 수 있다(박 등, 2003). 절토지에서는 바랭이, 강아지풀, 망초, 피, 참방동사니 순으로 우점하
// 였고, 객토지에서는 바랭이, 강아지풀, 개망초, 돌콩, 참방동사니 순이었으며, 경사지에서는
// 바랭이, 강아지풀, 피, 개여뀌, 바람하늘지기 순으로 많았다(황 등, 2004). 따라서, 김(1988)
// 이 제시한 것처럼 잡초의 군락상태를 정확히 파악한 다음 예방적 경종하는 것이 필요하다.
// 멀칭을 통한 잡초 발생을 억제하면 제초 노력이 감소되어 생산비 절감으로 농가 소득향상
// 에 도움이 될 수 있을 것이라 생각된다.

// 가을감자 재배시 대조구에서 돌피, 명아주, 망초, 뚝새풀 및 기타 잡초의 건물중이 다른
// 멀칭구보다 무거웠다(Table 5). 멀칭에 따른 피와 명아주의 건물중은 대조구, 톱밥 멀칭구,
// 왕겨 멀칭구 순으로 무거웠으며, 망초, 뚝새풀은 대조구, 왕겨 멀칭구, 톱밥 멀칭구 순으로
// 무거웠다.
// 봄감자 재배시 피, 방동사니, 망초, 쇠비름, 바랭이 등 모든 잡초의 건물중은 대조구에서 가장 무거웠다. 봄재배시 잡초의 건물중은 가을재배와 같은 경향으로 초종에 관계없이 대
// 조구, 톱밥 멀칭구 또는 왕겨 멀칭구에서 많았다.
// 멀칭 재료에 따른 잡초의 발생량은 잡초 발생수와 같이 멀칭 처리구가 대조구 총량은
// 14~46% 수준이었다. 김(2005)은 멀칭에 의한 잡초 발생량 감소는 멀칭이 잡초 발생과 생육
// 을 억제했기 때문이라고 보고하였다.
// 가을감자 및 봄감자 재배시 참나무잎, 솔잎 멀칭이 잡초 발생 억제에 가장 효과적이었으
// 며, 톱밥과 왕겨 멀칭은 잡초 발생 효과가 가장 낮았다. 작물 재배시 우점 잡초는 재배시기,
// 작물, 멀칭재료, 토양에 따라 다르다(노와 변, 2004; 연 등, 1991; 박 등, 2003; 황 등, 2004).
// 작물 잔재의 멀칭은 작물의 발육에 관여하며(Lodhi 등, 1987), oat 멀칭시 oat가 토양 중에서
// 분해되면서 allelopathic compounds의 작용으로 작물 생육에 영향을 준다(Fortin과 Pierce,
// 1991). 따라서, 유기물 멀칭재료와 감자, 감자와 잡초, 잡초간 상호 allelophathy와 competition에 관한 추가적인 연구가 필요하다고 판단되었다.
// 이상의 결과를 종합하면 감자를 재배할 때 솔잎, 짚, 왕겨, 참나무잎, 톱밥 등을 멀칭하면
// 지온을 1.0~2.5℃ 낮출 수 있고, 토양 수분 함량을 유지하여 감자 생육을 촉진하고 수량이
// 증수되고 잡초의 발생량을 줄일 수 있다.
// Ⅳ.요 약
// 몇 가지 멀칭 재료가 감자의 생육과 잡초 방제에 미치는 영향을 구명코자 충북대학교 부
// 속농장에서 2008년 8월 9일부터 2009년 6월 28일까지 수행하였다. 시험 품종은 ‘수미’였으
// 며, 솔잎, 참나무잎, 짚, 왕겨, 톱밥 멀칭과 대조구(무멀칭) 등 6처리를 하였다. 재배시기에
// 따라 가을재배와 봄재배로 구분하였다. 본 연구 결과를 요약하면 다음과 같다. 가을감자의
// 초장, 경장, 엽장, 엽중, 괴경중은 솔잎 멀칭구에서 다른 처리와 유의성을 나타냈다. 가을감
// 자 재배시 우점 잡초는 돌피, 명아주이었으며, 봄감자 재배시 우점 잡초는 돌피, 방동사니
// 이었다. 멀칭에 따른 잡초 발생 억제 효과는 모든 멀칭구가 대조구와 유의성을 나타냈다.
// 수분함량은 왕겨 멀칭구에서 가장 높아 대조구와 차이를 나타냈다. 멀칭 처리구의 지온은
// 대조구에 비해 가을감자 재배시 1.0~2.8℃ 낮았고, 봄감자 재배시 0.7~2.3℃ 낮았다. 멀칭재
// 료에 따른 지온은 솔잎 멀칭구, 짚 멀칭구, 낙엽 멀칭구, 왕겨 멀칭구, 톱밥 멀칭구, 대조구
// 순으로 낮았다.`

// function splitTextIntoParagraphs(text, maxLength = 1000) {
//   const paragraphs = text.split('\n\n');
//   const chunks = [];
  
//   let currentChunk = '';
//   for (const paragraph of paragraphs) {
//     if ((currentChunk + paragraph).length > maxLength) {
//       chunks.push(currentChunk.trim());
//       currentChunk = paragraph;
//     } else {
//       currentChunk += (currentChunk ? '\n\n' : '') + paragraph;
//     }
//   }
  
//   if (currentChunk) chunks.push(currentChunk.trim());
//   return chunks;
// }

// // 코사인 유사도 계산
// function cosineSimilarity(vecA, vecB) {
//   const dotProduct = vecA.reduce((sum, a, i) => sum + a * vecB[i], 0);
//   const magnitudeA = Math.sqrt(vecA.reduce((sum, a) => sum + a * a, 0));
//   const magnitudeB = Math.sqrt(vecB.reduce((sum, b) => sum + b * b, 0));
//   return dotProduct / (magnitudeA * magnitudeB);
// }

// // 문서 임베딩 캐시
// let documentEmbeddings = null;

// // 문서 임베딩 로드 및 캐싱
// async function loadDocumentEmbeddings() {
//   if (documentEmbeddings) return documentEmbeddings;

//   const chunks = splitTextIntoParagraphs(DOCUMENT_TEXT);
  
//   const embeddingsPromises = chunks.map(async (chunk) => {
//     const response = await openai.embeddings.create({
//       model: "text-embedding-ada-002",
//       input: chunk
//     });
//     return {
//       text: chunk,
//       embedding: response.data[0].embedding
//     };
//   });

//   documentEmbeddings = await Promise.all(embeddingsPromises);
//   return documentEmbeddings;
// }

// // 쿼리와 가장 유사한 문맥 검색
// function findMostRelevantContext(queryEmbedding, documentEmbeddings, topK = 2) {
//   const similarities = documentEmbeddings.map(doc => ({
//     text: doc.text,
//     similarity: cosineSimilarity(queryEmbedding, doc.embedding)
//   }));

//   return similarities
//     .sort((a, b) => b.similarity - a.similarity)
//     .slice(0, topK)
//     .map(item => item.text);
// }

// export const runtime = 'edge';

// export async function POST(req) {
//   try {
//     const { messages } = await req.json();
    
//     // 마지막 사용자 메시지 추출
//     const lastUserMessage = messages[messages.length - 1].content;

//     // 문서 임베딩 로드
//     const documentEmbeddings = await loadDocumentEmbeddings();

//     // 쿼리 임베딩 생성
//     const queryEmbeddingResponse = await openai.embeddings.create({
//       model: "text-embedding-ada-002",
//       input: lastUserMessage
//     });

//     // 관련 문맥 검색
//     const relevantContexts = findMostRelevantContext(
//       queryEmbeddingResponse.data[0].embedding, 
//       documentEmbeddings
//     );

//     // RAG를 위한 시스템 메시지 추가-문서 우선 검색 후 이후 일반 지식으로 답변하도록
//     const ragMessages = [
//       { 
//         role: "system", 
//         content: `다음 문맥을 참고하여 사용자의 질문에 답변하세요. 문맥에 정확한 답변이 없으면 일반적인 지식을 사용하세요.\n\n문맥: ${relevantContexts.join('\n\n')}`
//       },
//       ...messages
//     ];

//     // OpenAI API 호출
//     const response = await openai.chat.completions.create({
//       model: "gpt-4o-mini",
//       stream: true,
//       messages: ragMessages
//     });

//     // 유저와 ai간 스트리밍 응답 처리
//     const stream = OpenAIStream(response);
//     return new StreamingTextResponse(stream);

//   } catch (error) {
//     console.error("Error in /api/chat:", error);
//     return new Response(JSON.stringify({ error: error.message }), {
//       status: 500,
//       headers: { "Content-Type": "application/json" },
//     });
//   }
// }



// 대화를 위한 코드
import { OpenAIStream, StreamingTextResponse } from 'ai';
import OpenAI from 'openai';

export const runtime = 'edge';

const openai = new OpenAI({
  apiKey: process.env.OPENAI_API_KEY
});

export async function POST(req) {
  try {
    const { messages } = await req.json();

    const response = await openai.chat.completions.create({
      // model: "ft:gpt-4o-mini-2024-07-18:personal::B8KG0kR1",
      // model: 'ft:gpt-4o-mini-2024-07-18:personal::B8L0NJsP',
      // model: 'ft:gpt-4o-mini-2024-07-18:personal::BA5RVMF3',
      // model: 'ft:gpt-4o-mini-2024-07-18:personal::BA6bQMRr',
      model: 'ft:gpt-4o-mini-2024-07-18:personal::BA8LKczV',
      stream: true,
      messages: messages
    });

    const stream = OpenAIStream(response);
    return new StreamingTextResponse(stream);
  } catch (error) {
    console.error("Error in /api/chat:", error);
    return new Response(JSON.stringify({ error: error.message }), {
      status: 500,
      headers: { "Content-Type": "application/json" },
    });
  }
}